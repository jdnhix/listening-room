<template>
	<div class="room">
		<RoomPlayer :room-id="this.roomId" />
		<Queue :room-id="this.roomId" />
	</div>
</template>


<script>
import RoomPlayer from './RoomPlayer.vue'
import Queue from './Queue.vue'
import Nav from './Nav.vue'

export default {
	name: 'Room',
	components: {Nav, RoomPlayer, Queue},
	data() {
		return {
			roomId: null,
		}
	},
	watch: {
		'$route.query' : {
			immediate: true,
			handler(newVal, oldVal) {
				this.roomId = newVal.roomId
			}
		}
	},
	mounted() {
		this.updateToken()
		this.$socket.emit('join', this.roomId)
	},
	beforeDestroy() {
		this.$socket.emit('leave', this.roomId)
	},
	methods: {
		updateToken() {
			setTimeout( ()=>{
				console.log('refreshing token')
				this.$store.dispatch('refreshAccessToken', {refreshToken: this.$store.state.user.refreshToken})
			}, 36000000)
		}
	}
}
</script>

<style>

    .room {
        display: flex;
        flex-direction: row;
        justify-content: space-around;
        width: 100%;
        height: 100%;
    }


</style>